---
base: "[[Web.HTTP.base]]"
作成者: Katsubo Katsubo
カテゴリー:
  - Web
作成日時: 2025-01-29T12:00:00
aliases: [HTTP/1.1, HTTP 1.1, HTTP1.1, HTTP 1.1 まとめ]
---

# [[HTTP 1.1|HTTP/1.1]]

本ドキュメントは、HTTPの誕生から[[HTTP 1.1|HTTP/1.1]]までの**設計思想・構造・特性**を、漏れなく体系的に整理したまとめである。単なる用語暗記ではなく、「なぜそう設計されたのか」を理解することを目的とする。

---

## 1. HTTPとは何か

* HTTP（HyperText Transfer Protocol）は、**クライアントとサーバー間で情報をやり取りするためのプロトコル**
* Webにおける通信の「意味（Semantics）」を定義する
* TCP/IPを土台として設計された（※HTTP/3のみ例外的にUDP/QUIC上）

HTTPは以下の特徴を持つ：

* リクエスト／レスポンス型
* ステートレス
* テキストベース（HTTP/1.x）

---

## 2. HTTPの歴史的進化

### 2.1 HTTP/0.9

* Web誕生時にTim Berners-Leeが使用していた事実上の最初のHTTP
* 公式な仕様書（[[RFC]]）は存在しない

特徴：

* メソッドは[[HTTPメソッド GET|GET]]のみ
* ヘッダーなし
* ステータスコードなし
* HTMLを取得するだけの非常に単純なプロトコル

```
GET /index.html
```

---

### 2.2 HTTP/1.0（RFC1945）

* 初めて標準化されたHTTP
* 1996年にRFC1945として公開（Informational）

背景：

* ブラウザ戦争により、仕様と実装が乖離
* 「理想の仕様」ではなく「当時の実装の実態」をまとめたもの

追加された主な要素：

* HTTPヘッダー
* ステータスコード（200, 404 など）
* [[HTTPメソッド GET|GET]]以外のメソッド（POSTなど）
* Content-Type（HTML以外のデータ転送が可能に）

---

### 2.3 [[HTTP 1.1|HTTP/1.1]]（RFC2616 → RFC7230系）

* Webを社会インフラとして成立させた完成形
* パフォーマンスとスケーラビリティを大幅に改善

主な追加・改善点：

* Hostヘッダー必須化
* 持続的接続（Keep-Alive）
* チャンク転送
* コンテンツネゴシエーション（Accept系ヘッダー）
* 高度なキャッシュ制御

---

## 3. クライアント／サーバーモデル

HTTPは**クライアント／サーバー型アーキテクチャ**を前提とする。

* クライアント：要求を送信する側
* サーバー：要求を待ち、処理し、応答する側

### 3.1 リクエスト／レスポンス型

* サーバーはクライアントからのリクエストが来るまで何もしない
* 通信は必ず「1リクエスト → 1レスポンス」で完結する

```
[ Client ]                               [ Server ]

  リクエスト作成
        |
        |  HTTP Request
        |──────────────────────────────▶|
        |                                | リクエスト待機
        |                                | 解析
        |                                | アプリ処理
        |                                | レスポンス作成
        |  HTTP Response                 |
        |◀──────────────────────────────|
        |
  レスポンス解析
  必要な処理を実行
```

---

## 4. HTTPメッセージの構造

HTTPメッセージは以下の2種類に分かれる：

* リクエストメッセージ
* レスポンスメッセージ

両者は**ほぼ同じ構造**を持つ。

```
ライン
ヘッダー
（空行）
ボディ（任意）
```

---

## 5. リクエストメッセージ

### 5.1 構造

```
リクエストライン
ヘッダー
（空行）
ボディ（任意）
```

### 5.2 リクエストライン

例：

```
GET /index.html HTTP/1.1
```

構成要素：

1. メソッド（[[HTTPメソッド GET|GET]], POST など）
2. [[URI・URL・URN|URI]]
3. HTTPバージョン

### 5.3 Hostヘッダー（必須）

```
Host: example.jp
```

理由：

* 1つのIPアドレスで複数のドメインを運用するため（バーチャルホスト）
* [[HTTP 1.1|HTTP/1.1]]では必須

### 5.4 ヘッダー

* ボディをどう扱うかを示すメタデータ
* 代表例：

  * Accept
  * Content-Type
  * Content-Length
  * Authorization
  * [[Cookie]]

### 5.5 ボディ

* 実際のデータ
* [[HTTPメソッド GET|GET]]では通常なし
* POST / PUTでは使用される

---

## 6. レスポンスメッセージ

### 6.1 構造

```
ステータスライン
ヘッダー
（空行）
ボディ（任意）
```

### 6.2 ステータスライン

例：

```
HTTP/1.1 404 Not Found
```

構成要素：

1. HTTPバージョン
2. ステータスコード
3. 理由フレーズ（人間向け）

※ プログラムが判断に使うのはステータスコードのみ

### 6.3 ステータスコード分類

* 2xx：成功
* 3xx：リダイレクト
* 4xx：クライアントエラー
* 5xx：サーバーエラー

### 6.4 Content-Type（MIMEタイプ）

```
Content-Type: application/json
Content-Type: text/html; charset=UTF-8
```

* ボディのデータ形式を示す
* MIMEタイプはインターネット共通のデータ種別表現

---

## 7. [[HTTP 1.1|HTTP/1.1]]で追加された重要機能

### 7.1 持続的接続（Persistent Connection）

* 1回のTCP接続を複数のHTTP通信で使い回す
* 接続コスト削減、レイテンシ改善

### 7.2 チャンク転送

* Content-Length不要
* レスポンスを小分けで逐次送信
* 動的生成コンテンツに有効

```
[サイズ]\r\n
データ\r\n
...
0
```

### 7.3 コンテンツネゴシエーション

* Accept / Accept-Language / Accept-Encoding
* クライアントとサーバーが最適な表現形式を選択

### 7.4 キャッシュ制御

* Cache-Control
* Expires
* ETag

→ 通信量削減と高速化

---

## 8. HTTPのステートレス性

### 8.1 ステートレスとは

* サーバーがクライアント固有の会話状態を保持しない
* 各リクエストは独立して完結する

```
[ クライアント ]                    [ サーバー ]
      |                                  |
      |  リクエストA（ログイン）            |
      |─────────────────────────────────▶|
      |                                  | 処理 → レスポンス
      |◀─────────────────────────────────| （誰かは覚えない）
      |                                  |
      |  リクエストB（カート追加）           |
      |─────────────────────────────────▶|
      |                                  | 処理 → レスポンス
      |◀─────────────────────────────────| （Aの内容は知らない）

サーバーは「前のリクエスト」を記憶しない → 各リクエストは独立
```

### 8.2 なぜステートフルが問題か

* クライアント数増加で状態管理が困難
* サーバー台数増加で状態同期が爆発的に増える

ステートフルだと、サーバー間で「誰の状態を誰が持っているか」を同期する必要がある。

```
3台のサーバー（ステートフル）の場合：

   [S1] ←──────→ [S2]
     ↖  ↙    ↖  ↙
       ↘  ↙  ↘↙
        [S3]

同期関係の数 = 3(3-1)/2 = 3本

4台なら 4×3/2 = 6本、10台なら 45本 … N台で N(N-1)/2 本
```

### 8.3 ステートレスの利点

* 水平スケールが容易
* ロードバランサーが単純
* サーバーは入れ替え可能な部品になる

```
[ クライアント群 ]
        |
        |  どのリクエストも
        |  どのサーバーへ流してもよい
        ▼
   [ ロードバランサー ]
        |
   ┌────┼────┬────┐
   ▼    ▼    ▼    ▼
 [S1] [S2] [S3] [S4]  ← どれも同じ・状態の同期不要
   │    │    │    │
   └────┴────┴────┘
   台数を増やすだけ → 水平スケールが容易
```

### 8.4 自己記述的メッセージ

* 各リクエストに必要な情報をすべて含める
* 状態はクライアント側が保持

```
[ クライアント ]                         [ サーバー ]
  （状態を保持）                            （状態を持たない）

  リクエストに「必要な情報を全部のせる」
        |
        |  GET /api/cart
        |  Cookie: session=abc123
        |  Authorization: Bearer xxxx
        |─────────────────────────────────▶|
        |                                  | ヘッダーを見るだけで
        |                                  | 誰か・何を返すかが分かる
        |◀─────────────────────────────────|
```

サーバーはDBやメモリで「このセッションの状態」を探さなくてよい（探す場合はアプリ層の設計）。

例：

```
Authorization: Bearer xxxx
```

※ [[Cookie]]やトークンは「HTTPの外側」で状態を擬似的に実現する仕組み

---

## 9. まとめ

* HTTPは単なる通信規約ではなく、分散システム設計思想
* ステートレス性はスケーラビリティ最優先の選択
* [[HTTP 1.1|HTTP/1.1]]の理解は、HTTP/2・HTTP/3・[[REST 概要|REST]]・クラウド設計の基礎となる

この土台理解が、Web技術全体を一貫して理解する軸となる。
