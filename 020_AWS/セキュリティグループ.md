---
base: "[[AWS.base]]"
作成者: Katsubo Katsubo
カテゴリー:
  - AWS
作成日時: 2025-02-03T12:00:00
aliases: [SG, セキュリティグループ, セキュリティグループ（SG）, Security Group, security group]
---
# AWS [[SG|セキュリティグループ（SG）]]まとめ

## 1. [[SG|セキュリティグループ]]とは何か

[[SG|セキュリティグループ（SG）]]は、AWS上のリソースに対して通信を許可・不許可するための**仮想ファイアウォール**である。

* VPC内で動作する
* L3/L4レベルで通信を制御する
* 「許可ルールのみ」を定義できる（拒否ルールは存在しない）
* ステートフルである（戻り通信は自動許可）

---

## 2. OSI参照モデルとの対応関係

| OSI層         | [[SG]]で制御可能か | 内容                 |
| ------------ | -------- | ------------------ |
| L3 ネットワーク層   | 可能       | IPアドレス（CIDR）       |
| L4 トランスポート層  | 可能       | TCP/UDP/ICMP、ポート番号 |
| L7 アプリケーション層 | 不可       | [[URI・URL・URN|URL]]、HTTPメソッド、ヘッダ等  |

補足：[[SG]]で選択できる「HTTP」「HTTPS」は、実体としては TCP 80 / TCP 443 のショートカットに過ぎない。

---

## 3. [[SG]]の実体：[[ENI]]との関係

[[SG]]は概念的には「リソースに付ける」ように見えるが、**実体としては [[ENI]]（[[ENI|Elastic Network Interface]]）に付与される**。

```
[ セキュリティグループ ]
          ↓
        [ ENI ]
          ↓
  EC2 / ALB / RDS / Fargate / Lambda(VPC)
```

[[ENI]]を持つリソースのみが[[SG]]を利用できる。

---

## 4. [[SG]]を付与できる主なリソース

* EC2
* ALB
* RDS / Aurora
* ECS（EC2 / Fargate）
* Lambda（VPC接続時）
* ElastiCache / OpenSearch など

### [[SG]]を付与できない代表例

* S3（[[ENI]]を持たない）
* CloudFront
* Route53

---

## 5. ALBと[[SG|セキュリティグループ]]

ALBは通信を単純に中継しているのではなく、**通信を一度終端し、別の通信として再生成する**。

```
Client ── TCPセッションA ──▶ ALB
ALB    ── TCPセッションB ──▶ EC2
```

このため、ALBにも必ず[[SG]]が必要になる。

---

## 6. ALB + EC2 の王道[[SG]]構成（具体例）

```
[ Internet ]
     ↓
[ SG: ALB ]
  - 443 from 0.0.0.0/0
  - 80  from 0.0.0.0/0（HTTPSリダイレクト用）
     ↓
[ ALB ]
     ↓
[ SG: EC2 ]
  - 443 from ALBのSG
     ↓
[ EC2 ]
```

ポイント：

* EC2はインターネットから直接アクセスさせない
* EC2の[[SG]]は「ALBの[[SG]]参照」で制御する

---

## 7. 80番ポートを開ける意味

原則として、本番環境では80番ポートは不要である。

### 例外：HTTPSリダイレクト

* 利用者が http:// でアクセスする可能性がある
* ALBで即座に https:// にリダイレクトする

この場合のみ、ALBの[[SG]]で80を許可する意味がある。

---

## 8. 複数[[SG]]を付けた場合の評価ルール

* 複数[[SG]]は **OR条件** で評価される
* どれか1つでも許可されていれば通信は通る

例：

* SG-A：80許可
* SG-B：443許可
  → 80 / 443 の両方が通る

---

## 9. アウトバウンドルールの注意点

* デフォルトは「全許可」
* 絞ると以下の問題が起きやすい

  * OSアップデート不可
  * SSM/ECRに接続不可
  * 外部APIに接続不可

アウトバウンド制御は上級者向けであり、Interface Endpoint併用が前提となる。

---

## 10. VPCエンドポイントと[[SG]]

### Interface Endpoint

* 実体は[[ENI]]
* [[SG]]を付与できる

```
[ EC2 ] → [ SG ] → [ ENI (Interface Endpoint) ] → AWSサービス
```

### Gateway Endpoint

* 実体はルートテーブル
* [[SG]]は利用できない（S3, DynamoDB）

---

## 11. [[SG]]はログを出さない

[[SG]]自体は、通信を許可・拒否してもログを一切出力しない。

### トラブルシュート時に見るべきもの

1. [[VPC Flow Logs]]（ACCEPT / REJECT）
2. ALBアクセスログ
3. アプリケーションログ

[[SG]]は「制御」、ログは「観測」という役割分離がされている。

---

## 12. 設計視点での本質

* [[SG]]はL3/L4レベルの最前線防御
* [[SG]]参照設計によりIP変動に強くなる
* [[SG]]構成を見ればシステム構成が推測できる

[[SG|セキュリティグループ]]は、単なる設定項目ではなく**設計そのもの**である。
