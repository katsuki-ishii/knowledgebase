---
base: "[[AWS.base]]"
作成者: Katsubo Katsubo
カテゴリー:
  - AWS
作成日時: 2025-02-03T12:00:00
aliases: [ENI, eni, Elastic Network Interface, エラスティックネットワークインターフェース]
---
# [[ENI]]とAWSネットワークの本質まとめ

---

## 1. [[ENI]]とは何か

[[ENI]]（[[ENI|Elastic Network Interface]]）は、AWSにおける**ネットワーク上の人格そのもの**である。

EC2やLambdaなどのリソースは、[[ENI]]を持つことで初めてVPCというネットワーク空間に存在できる。

```
[ EC2 ]   [ RDS ]   [ Lambda ]
   |         |         |
  ENI       ENI       ENI
    \        |        /
          [ VPC ]
```

VPCに存在するすべての通信主体は、必ず[[ENI]]を介して通信を行う。

---

## 1-2. [[ENI]]の設計思想（なぜ分離されたのか）

[[ENI]]の背景にある設計思想は、**サーバを使い捨て可能にすること**にある。

オンプレミス時代、サーバは以下を一体で持っていた。

* 計算資源
* ストレージ
* ネットワーク設定（IP・FW・ルーティング）

```
[ Server ]
  ├─ CPU
  ├─ Disk
  └─ IP / FW / Routing
```

この構造では、サーバ障害＝ネットワーク人格の消失を意味した。

AWSはこれを分離した。

```
[ EC2 ]        [ ENI ]        [ EBS ]
  CPU            IP             Disk
  Memory         SG
                 Subnet
```

計算資源（EC2）は壊れてよい存在とし、
ネットワーク人格（[[ENI]]）とデータ（EBS）を外部に切り出した。

---

## 1-3. 人格を付け替えられるという価値

[[ENI]]が独立リソースであることにより、以下が可能になる。

* EC2障害時に[[ENI]]を別EC2へアタッチ
* IPアドレス・[[セキュリティグループ|SG]]・通信経路の即時引き継ぎ

```
[ ENI ] ---> [ EC2-A ] (障害)
   |
   +-------> [ EC2-B ] (復旧)
```

これは「修理」ではなく「交換」による可用性設計である。

---

## 1-4. [[ENI]]は境界を作るための装置

[[ENI]]は単なる接続点ではなく、**信頼境界を物理的に切るための装置**である。

* 外部公開用[[ENI]]
* 内部通信用[[ENI]]
* 管理用[[ENI]]

```
        [ EC2 ]
        /  |  \
   Public Private Admin
     ENI    ENI    ENI
```

境界を[[ENI]]単位で分離することで、
セキュリティと設計の見通しが大幅に向上する。

---

## 2. [[ENI]]が持つもの

[[ENI]]は単なるNICではなく、以下の属性をまとめて保持する。

* プライベートIPアドレス
* パブリックIP（任意）
* MACアドレス
* [[セキュリティグループ]]
* 所属サブネット
* Source/Destination Check

重要なのは、**IPやセキュリティ設定はEC2ではなく[[ENI]]の属性**である点。

```
EC2
 └─ ENI
     ├─ IPアドレス
     ├─ セキュリティグループ
     └─ サブネット
```

---

## 3. IPアドレスの正体

IPアドレスはEC2のものではない。
[[ENI]]が保持し、EC2はそれを借りているだけである。

```
[ ENI ] ---- IP: 10.0.1.10
    |
  [ EC2 ]
```

そのため、以下が可能になる。

* EC2を停止・破棄してもIPは保持される
* [[ENI]]を別EC2に付け替えるとIPも引き継がれる

---

## 4. [[セキュリティグループ]]の正体

[[セキュリティグループ]]はEC2に付与されるのではなく、**[[ENI]]に付与される**。

```
通信
 ↓
[ ENI ] -- SG判定 -- OK / NG
```

どの[[ENI]]に入ってきた通信かによって、適用されるルールが決まる。

---

## 5. [[ENI]]とルートテーブルの関係

重要な前提：

* ルートテーブルは[[ENI]]に紐づかない
* ルートテーブルはサブネットに紐づく

通信の流れは常に以下の順序で評価される。

```
① パケットがENIに到着
② セキュリティグループ評価
③ ENIが属するサブネットの
   ルートテーブル参照
④ 次の宛先へ転送
```

[[ENI]] → サブネット → ルートテーブル
という間接的な関係が成立している。

---

## 6. 図解：通信の全体像

```
[ Client ]
    |
    v
[ ENI ]
  |  \
  |   -- セキュリティグループ
  v
[ Subnet ]
    |
    v
[ Route Table ]
    |
    +--> IGW
    +--> NAT Gateway
    +--> VPC Peering
```

通信は常に「どの[[ENI]]に入ったか」を起点に進路が決まる。

---

## 7. マルチ[[ENI]]とルーティングの具体例

### 構成例

* EC2に[[ENI]]を2枚アタッチ

```
ENI-A（Public Subnet） → RT-A → IGW
ENI-B（Private Subnet）→ RT-B → NAT
```

### 挙動

* ENI-Aから出た通信：インターネットへ直接
* ENI-Bから出た通信：NAT経由で外部へ

```
        [ EC2 ]
        /     \
   [ENI-A]   [ENI-B]
     |           |
   Public      Private
     |           |
    IGW        NAT
```

同じEC2でも、送信元[[ENI]]が違うと通信経路は[[ITと不完全さに惹かれる理由|完全]]に変わる。

---

## 8. Source/Destination Checkとの関係

通常の[[ENI]]は「自分宛の通信」のみ処理する。

これを無効化すると、以下が可能になる。

* ルータ
* NATインスタンス
* ファイアウォール

```
[ ENI ] (S/D Check OFF)
   |
 他人宛通信も転送
```

ただし、進路は必ずルートテーブルに従う。

---

## 9. スケールと[[ENI]]

[[ENI]]は無限ではない。

* Lambdaの同時実行
* ECS / EKSのタスク増加

これらはすべて[[ENI]]の増加を伴う。

```
Lambda実行数 ↑
   ↓
ENI数 ↑
   ↓
IP枯渇 / ENI上限
```

[[ENI]]はスケーラビリティのボトルネックになり得る。

---

## 10. 本質の一文まとめ

AWSのネットワークは、以下の構造で動いている。

> 通信は必ず[[ENI]]に入り、
> [[セキュリティグループ]]で裁かれ、
> サブネットのルートテーブルによって進路を決められる

[[ENI]]はAWSネットワーク設計の起点であり、人格であり、境界である。
